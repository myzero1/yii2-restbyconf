<!DOCTYPE HTML>
<html>
<head>
  <title>JSONEditor | JSON schema validation</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <link href="../dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
  <script src="../dist/jsoneditor.min.js"></script>

  <style type="text/css">
    body {
      width: 600px;
      font: 11pt sans-serif;
    }
    #jsoneditor {
      width: 100%;
      height: 500px;
    }

    /* custom bold styling for non-default JSON schema values */
    .jsoneditor-is-not-default {
      font-weight: bold;
    }
  </style>
</head>
<body>
<h1>JSON schema validation</h1>
<p>
  This example demonstrates JSON schema validation. The JSON object in this example must contain properties like <code>firstName</code> and <code>lastName</code>, can can optionally have a property <code>age</code> which must be a positive integer.
</p>
<p>
  See <a href="http://json-schema.org/" target="_blank">http://json-schema.org/</a> for more information.
</p>

<div id="jsoneditor"></div>

<script>

  var schemas = {
    "schema": {
      "title": "Example Schema",
      "type": "object",
      "properties": {
        "firstName": {
          "title": "First Name",
          "description": "The given name.",
          "examples": [
            "John"
          ],
          "type": "string"
        },
        "PersonTemplate": {
          "$ref": "PersonTemplate"
        }
      },
      "required": ["firstName", "lastName"]
    },
    "PersonTemplate": {
      "title": "Job description",
      "type": "object",
      "required": ["age"],
      "properties": {
        "age": {
          "type": "string",
          "examples": [
            "ACME",
            "Dexter Industries"
          ]
        }
      }
    }
  }

  var schema = {
    "title": "Example Schema",
    "type": "object",
    "properties": {
      "firstName": {
        "title": "First Name",
        "description": "The given name.",
        "examples": [
          "John"
        ],
        "type": "string"
      },
      "PersonTemplate": {
        "$ref": "PersonTemplate"
      }
    },
    "required": ["firstName", "lastName"]
  };

  var PersonTemplate = {
    "title": "Job description",
    "type": "object",
    "required": ["age"],
    "properties": {
      "age": {
        "type": "string",
        "examples": [
          "ACME",
          "Dexter Industries"
        ]
      }
    }
  };
// JSONEditor.setSchema(schema [,schemaRefs])
  var json = {
    firstName: 'John',
    PersonTemplate: {
        'age': '28a'
    }
  };

  var options = {
    schema: schemas['schema'],
    schemaRefs: schemas,
    mode: 'tree',
    modes: ['code', 'text', 'tree'],
    templates: [
        {
            text: 'Person',
            title: 'Insert a Person Node',
            className: 'jsoneditor-type-object',
            field: 'PersonTemplate',
            value: {
                'age': '28a'
            }
        },
        {
            text: 'Address',
            title: 'Insert a Address Node',
            field: 'AddressTemplate',
            value: {
                'street': '',
                'city': '',
                'state': '',
                'ZIP code': ''
            }
        }
    ],
    onChangeJSON: function(json,a){
      // console.log(json);
      // console.log(a);
      // editor.setSchema(this.schema,this.schemaRefs);

    },
    onEditable: function(path){
      // console.log(path);
      return true;
    },
    onEvent:function (node, event) {
      if (event.type == 'mouseout') {
        var schema = this.schema;
        schema['properties'][node.field] = {
          "$ref": "PersonTemplate"
        };

        editor.setSchema(schema,this.schemaRefs);
      }
    }
  };

  // create the editor
  var container = document.getElementById('jsoneditor');
  var editor = new JSONEditor(container, options, json);
</script>
</body>
</html>
