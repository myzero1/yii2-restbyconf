<!DOCTYPE HTML>
<html>
<head>
  <title>0-conf.html</title>
<meta charset="UTF-8">
  <link href="../dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
  <!-- <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script> -->
  <script src="../dist/jsoneditor.min.js"></script>
  <script src="../dist/jquery.min.js"></script>

  <style type="text/css">
    body {
      width: 600px;
      font: 11pt sans-serif;
    }
    #jsoneditor {
      width: 100%;
      height: 500px;
    }

    /* custom bold styling for non-default JSON schema values */
/*    .jsoneditor-is-not-default {
      font-weight: bold;
    }*/
/*    div.jsoneditor-tree button.jsoneditor-dragarea{
        display: none;
    }*/

  </style>
</head>
<body>
<h1>JSON schema validation</h1>
<p>
  This example demonstrates JSON schema validation. The JSON object in this example must contain properties like <code>firstName</code> and <code>lastName</code>, can can optionally have a property <code>age</code> which must be a positive integer.
</p>
<p>
  See <a href="http://json-schema.org/" target="_blank">http://json-schema.org/</a> for more information.
</p>

<div id="jsoneditor"></div>

<script>
    var json = {
        "swagger": "2.0",
        "tags": {
            "TagTemplate": {
                "name": "userName",
                "paths": {
                    "create": {
                        "name": "create",
                        "inputs": {
                            "in_str": {
                                "des": "myzero1"
                            }
                        }
                    }
                }
            }
        }
    };

    var templates = [
            {
                text: 'tag',
                title: 'Insert a Tag Node',
                className: 'jsoneditor-append jsoneditor-default',
                field: '',
                value: {
                    "name": "tagName",
                    "paths": {
                        "create": {
                            "name": "create"
                        }
                    }
                }
            },
            {
                text: 'create',
                title: 'Insert a CreatePath Node',
                className: 'jsoneditor-append jsoneditor-default',
                field: 'create',
                value: {
                    "name": "create"
                }
            },
            {
                text: 'in_str',
                title: 'Insert a CreatePath Node',
                className: 'jsoneditor-append jsoneditor-default',
                field: '',
                value: {
                    "des": "myzro1"
                }
            },
            {
                text: 'index',
                title: 'restbyconf-obj-path',
                className: 'jsoneditor-append jsoneditor-default',
                field: 'index',
                value: {
                    "name": "index"
                }
            },
            {
                text: 'update',
                title: 'Insert a CreatePath Node',
                className: 'jsoneditor-append jsoneditor-default',
                field: 'update',
                value: {
                    "name": "update"
                }
            },
            {
                text: 'view',
                title: 'Insert a CreatePath Node',
                className: 'jsoneditor-append jsoneditor-default',
                field: 'view',
                value: {
                    "name": "view"
                }
            },
            {
                text: 'delete',
                title: 'Insert a CreatePath Node',
                className: 'jsoneditor-append jsoneditor-default',
                field: 'delete',
                value: {
                    "name": "delete"
                }
            }
        ];

    var schemas = {
        "schema": {
            "title": "The configuration of restful api",
            "type": "object",
            "required": ["swagger", "tags"],
            "properties": {
                "swagger": {
                    "title": "swagger version",
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "2.0",
                        "2.1"
                    ]
                },
                "tags": {
                    "$ref": "tags"
                }
            }
        },
        "tags": {
            "title": "restbyconf-obj-tags",
            "type": "object",
            "required": [],
            "properties": {
                "TagTemplate": {
                    "$ref": "tag"
                }
            }
        },
        "tag": {
            "title": "restbyconf-obj-tag",
            "type": "object",
            "required": ["name", "paths"],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "user",
                        "log"
                    ],
                },
                "paths": {
                    "$ref": "paths"
                }
            }
        },
        "paths": {
            "title": "Paths description",
            "type": "object",
            "required": [],
            "properties": {
                "create": {
                    "$ref": "create"
                }
            }
        },
        "create": {
            "title": "restbyconf-obj-path",
            "type": "object",
            "required": ["name"],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "create",
                        "update"
                    ],
                },
                "inputs": {
                    "$ref": "inputs"
                }
            }
        },
        "inputs": {
            "title": "restbyconf-obj-inputs",
            "type": "object",
            "required": [],
            "properties": {
                "in_str": {
                    "$ref": "in_str"
                }
            }
        },
        "in_str": {
            "title": "restbyconf-obj-input",
            "type": "object",
            "required": ["des"],
            "properties": {
                "des": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "user name"
                    ],
                }
            }
        },
        "index": {
            "title": "restbyconf-obj-path",
            "type": "object",
            "required": ["name"],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "create",
                        "update"
                    ],
                },
            }
        },
        "update": {
            "title": "restbyconf-obj-path",
            "type": "object",
            "required": ["name"],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "create",
                        "update"
                    ],
                },
            }
        },
        "view": {
            "title": "restbyconf-obj-path",
            "type": "object",
            "required": ["name"],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "create",
                        "update"
                    ],
                },
            }
        },
        "delete": {
            "title": "restbyconf-obj-path",
            "type": "object",
            "required": ["name"],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 32,
                    "examples": [
                        "create",
                        "update"
                    ],
                },
            }
        }
    };

    // for contextmenu
    var style = `
    <style>
        // .jsoneditor-contextmenu{
        //     display:none;
        // }
        .jsoneditor-dragarea{
            display:none;
        }
    </style>
    `;
    // $("body").append(style);











    function Restbyconf(container, json, schema, schemaRefs, templates){
        restbyconf = this;
        this.editor = {};
        this.container = container;
        this.json = json;
        this.schema = schema;
        this.schemaRefs = schemaRefs;
        this.templates = templates;

        this.run = function(){
            var options = {
                schema: this.schema,
                schemaRefs: this.schemaRefs,
                templates: this.templates,
                mode: 'tree',
                modes: ['view', 'tree'],
                enableSort: false,
                enableTransform: false,
                onEditable: this.onEditable,
                onNodeName: this.onNodeName
                // onChangeJSON: this.onChangeJSON,
                // onCreateMenu: this.onCreateMenu,
                // onEvent: this.onEvent,
            };
            this.editor = new JSONEditor(this.container, options, this.json);
        };

        this.onEditable = function(node) {
            restbyconf.confEditable(node);
            // restbyconf.updatePathValidation(node);
        };

        this.confEditable = function(node){
            var unEditable = [
                'swagger',
                'tags'
            ];
            if (Array.isArray(node.path)) {
                var path = node.path.join('-');
                if (unEditable.indexOf(path) > -1) {
                    return false;
                } else {
                    if(this.isTagLay(node.path)){
                        return true;
                    } else if(this.isInputLay(node.path)){
                        return true;
                    } else {
                        return {
                          field: false,
                          value: true
                        };
                    }
                }
            } else {
                return true;
            } 
        }

        this.isTagLay = function(path){
            if (path.length == 2 && path[0] == 'tags') {
                return true;
            } else {
                return false;
            }
        }

        this.isInputLay = function(path){
            if (path.length == 6 && path[0] == 'tags' && path[2] == 'paths' && path[4] == 'inputs') {
                return true;
            } else {
                return false;
            }
        }

        this.updatePathValidation = function(node){
            if (Array.isArray(node.path)) {
                if (this.isPathLay(node.path)) {
                    var schemaRefs = this.schemaRefs;
                    schemaRefs['paths']['properties'][node.field] = {
                      "$ref": node.field
                    };
                    editor.setSchema(this.schema,schemaRefs);
                }
            }
        }

        this.isPathLay = function(path){
            if (path.length == 4 && path[0] == 'tags' && path[2] == 'paths') {
                return true;
            } else {
                return false;
            }
        }

        this.onNodeName = function(node){
            console.log(node);
        };
    }


    var container = document.getElementById('jsoneditor');

    var conf = new Restbyconf(container, json, schemas['schema'], schemas, templates);

    conf.run();
    



</script>
</body>
</html>
